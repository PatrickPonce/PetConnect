@model List<PetConnect.ViewModels.UsuarioViewModel>
@{
    ViewData["Title"] = "Gestión de usuarios";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    // Recuperamos los filtros actuales para los controles del formulario
    string currentNameFilter = ViewData["CurrentNameFilter"] as string ?? "";
    string currentStatusFilter = ViewData["CurrentStatusFilter"] as string ?? "todos";
}

<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />

<style>
    /* ... (Tus estilos CSS van aquí - SIN CAMBIOS) ... */
    body { background-color: #fdfaf1; font-family: 'Poppins', sans-serif; }
    .admin-user-list-container { max-width: 900px; margin: 2rem auto; padding: 0 1rem; }
    .page-title-admin { text-align: center; font-size: 2.5rem; font-weight: bold; color: #ff8fab; margin-bottom: 1.5rem; /* Reducido */ }

    /* --- ESTILOS PARA LOS FILTROS --- */
    .filters-container { background-color: #fff; padding: 20px; border-radius: 10px; margin-bottom: 25px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); display: flex; gap: 15px; align-items: flex-end; }
    .filter-group { flex-grow: 1; }
    .filter-group label { display: block; font-weight: 600; color: #555; margin-bottom: 5px; font-size: 0.9rem; }
    .filter-input, .filter-select { width: 100%; padding: 10px 12px; border: 1px solid #ddd; border-radius: 8px; font-size: 0.95rem; }
    .filter-buttons { display: flex; gap: 10px; }
    .btn-filter { padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: background-color 0.3s; background-color: #ff8fab; color: white; border: none; }
    .btn-filter:hover { background-color: #f87aa0; }
    .btn-clear-filter { padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; transition: background-color 0.3s, color 0.3s; background-color: #f0f0f0; color: #555; border: 1px solid #ddd; text-decoration: none; }
    .btn-clear-filter:hover { background-color: #e0e0e0; }
    /* --- FIN ESTILOS FILTROS --- */

    .user-card-admin { display: flex; align-items: center; background-color: #EAEAEA; border-radius: 15px; padding: 25px; margin-bottom: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.07); gap: 30px; }
    .user-avatar-admin { width: 110px; height: 110px; border-radius: 50%; object-fit: cover; border: 5px solid white; flex-shrink: 0; background-color: #f8f8f8; }
    .user-info-admin { flex-grow: 1; text-align: left; }
    .user-name-admin { font-size: 1.8rem; font-weight: bold; color: #333; margin-bottom: 10px; }
    .user-contact-admin { color: #555; font-size: 0.9rem; display: grid; grid-template-columns: auto 1fr; align-items: center; gap: 8px 15px; }
    .user-contact-admin span { display: contents; }
    .user-contact-admin .material-symbols-outlined { font-size: 1.1rem; color: #777; justify-self: center; }
    .user-actions-admin { display: flex; flex-direction: column; gap: 12px; align-items: flex-end; }
    .btn-admin { padding: 9px 20px; border: none; border-radius: 8px; font-size: 0.9rem; font-weight: 600; cursor: pointer; transition: background-color 0.3s; min-width: 130px; text-align: center; }
    .btn-block-admin { background-color: #6c757d; color: white; }
    .btn-block-admin:hover { background-color: #5a6268; }
    /* Nuevo estilo para Desbloquear */
    .btn-unblock-admin { background-color: #28a745; color: white; } 
    .btn-unblock-admin:hover { background-color: #218838; }
    .btn-delete-admin { background-color: #dc3545; color: white; }
    .btn-delete-admin:hover { background-color: #c82333; }
    .icon-facebook { background-color: #3b5998; color: white; border-radius: 50%; padding: 4px; font-size: 1rem !important; }

</style>

<div class="admin-user-list-container"> 

    <h1 class="page-title-admin">Gestión de usuarios</h1>

    <form asp-action="Index" method="get" class="filters-container">
        <div class="filter-group">
            <label for="searchString">Buscar por Nombre o Email</label>
            <input type="text" id="searchString" name="searchString" class="filter-input" placeholder="Escribe nombre o email..." value="@currentNameFilter" />
        </div>
        <div class="filter-group" style="flex-grow: 0.5;"> <label for="statusFilter">Filtrar por Estado</label>
            <select id="statusFilter" name="statusFilter" class="filter-select">
                <option value="todos" selected="@(currentStatusFilter == "todos")">Todos</option>
                <option value="activo" selected="@(currentStatusFilter == "activo")">Activos</option>
                <option value="bloqueado" selected="@(currentStatusFilter == "bloqueado")">Bloqueados</option>
            </select>
        </div>
        <div class="filter-buttons">
            <button type="submit" class="btn-filter">
                 <span class="material-symbols-outlined" style="font-size: 1.2rem; vertical-align: middle; margin-right: 5px;">search</span>Buscar
            </button>
            <a asp-action="Index" class="btn-clear-filter">Borrar Filtros</a>
        </div>
    </form>
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
     @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    @if (!Model.Any())
    {
        <p class="text-center mt-4">No se encontraron usuarios que coincidan con los filtros.</p>
    }
    else
    {
        @foreach (var user in Model)
        {
            <div class="user-card-admin">
                <img src="@(user.ProfilePictureUrl ?? "/images/avatars/default.png")" alt="Avatar" class="user-avatar-admin" />
                
                <div class="user-info-admin">
                    <div class="user-name-admin">@user.NombreUsuario</div>
                    <div class="user-contact-admin">
                        <span><span class="material-symbols-outlined">badge</span> Información Personal</span>
                        <span><span class="material-symbols-outlined">call</span> @(user.NumeroTelefono ?? "No especificado")</span>
                        <span><span class="material-symbols-outlined">mail</span> @(user.Email ?? "No especificado")</span>
                        <span><span class="material-symbols-outlined icon-facebook">facebook</span> Facebook (Placeholder)</span>
                    </div>
                </div>

                <div class="user-actions-admin">
                    <form asp-action="ToggleBloqueoUsuario" method="post" onsubmit="return confirm('@(user.IsLockedOut ? "¿Desbloquear a este usuario?" : "¿Bloquear a este usuario?")');">
                        <input type="hidden" name="userId" value="@user.Id" />
                        @Html.AntiForgeryToken()
                        
                        @if (user.IsLockedOut)
                        {
                            <button type="submit" class="btn-admin btn-unblock-admin">Desbloquear</button>
                        }
                        else
                        {
                            <button type="submit" class="btn-admin btn-block-admin">Bloquear</button>
                        }
                    </form>
                    <form asp-action="EliminarUsuario" method="post" onsubmit="return confirm('¡ADVERTENCIA! ¿Estás seguro de querer ELIMINAR permanentemente a este usuario? (Funcionalidad pendiente)');">
                        <input type="hidden" name="userId" value="@user.Id" />
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn-admin btn-delete-admin">Eliminar cuenta</button>
                    </form>
                </div>
            </div>
        }
    }
</div>

@section Scripts {
    }