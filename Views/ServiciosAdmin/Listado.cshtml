@using X.PagedList.Mvc.Core
@using X.PagedList
@using PetConnect.Models
@model IPagedList<PetConnect.Models.Servicio>

@{
    // Usamos el título dinámico que pasamos desde el controlador
    ViewData["Title"] = ViewData["Title"];
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
    var tipoActual = ViewData["TipoActual"]?.ToString();
}

<style>
    .admin-container-stable { min-height: 600px; }
    .admin-page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; }
    .admin-page-title-group { display: flex; align-items: center; gap: 15px; }
    .btn-back { color: #555; text-decoration: none; display: flex; align-items: center; justify-content: center; width: 40px; height: 40px; border-radius: 50%; background-color: #f0f0f0; transition: all 0.2s; }
    .btn-back:hover { background-color: #e0e0e0; color: #333; }
    .admin-page-title { color: #333; font-weight: 800; font-size: 2rem; margin: 0; }
    .btn-add-new { background-color: #E88989; color: white; font-weight: 700; padding: 0.7rem 1.5rem; border-radius: 10px; border: none; display: flex; align-items: center; gap: 8px; transition: all 0.3s; text-decoration: none; }
    .btn-add-new:hover { background-color: #d17a7a; transform: translateY(-2px); color: white; box-shadow: 0 5px 15px rgba(232, 137, 137, 0.3); }

    /* Filtros simplificados */
    .filters-card { background: white; padding: 20px 25px; border-radius: 15px; margin-bottom: 2rem; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .filter-form { display: flex; gap: 15px; align-items: flex-end; }
    .filter-group { flex: 1; }
    .filter-label { font-weight: 700; color: #555; margin-bottom: 8px; font-size: 0.9rem; }
    .filter-input { width: 100%; padding: 10px 15px; border: 2px solid #eee; border-radius: 10px; transition: border-color 0.3s; }
    .filter-input:focus { border-color: #97a992; outline: none; }
    .btn-filter { background-color: #97a992; color: white; font-weight: 700; padding: 10px 25px; border-radius: 10px; border: none; transition: background 0.3s; }
    .btn-filter:hover { background-color: #82947c; }
    .btn-clear { background-color: #f5f5f5; color: #555; font-weight: 600; padding: 10px 20px; border-radius: 10px; text-decoration: none; border: 1px solid #ddd; transition: all 0.3s; }
    .btn-clear:hover { background-color: #eee; color: #333; }

    /* Tabla (igual que Index) */
    .admin-table-card { background: white; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); overflow-x: auto; }
    .admin-table { width: 100%; border-collapse: separate; border-spacing: 0; table-layout: fixed; }
    .admin-table th { background-color: #f8f9fa; color: #777; font-weight: 700; text-transform: uppercase; font-size: 0.85rem; padding: 1.2rem; border-bottom: 2px solid #eee; text-align: left; }
    .admin-table td { padding: 1rem 1.2rem; border-bottom: 1px solid #f0f0f0; vertical-align: middle; color: #555; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .col-img { width: 80px; } .col-name { width: 30%; } .col-desc { width: auto; } .col-actions { width: 120px; text-align: right !important; }
    .service-img-container { width: 50px; height: 50px; border-radius: 10px; overflow: hidden; background-color: #f0f0f0; border: 1px solid #eee; }
    .service-img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .action-btn { width: 35px; height: 35px; border-radius: 8px; display: inline-flex; align-items: center; justify-content: center; border: none; cursor: pointer; transition: all 0.2s; color: #555; background-color: #f5f5f5; text-decoration: none; margin-left: 5px; }
    .action-btn:hover { background-color: #eee; color: #333; transform: translateY(-2px); }
    .btn-edit:hover { background-color: #e3f2fd; color: #1976d2; }
    .btn-delete:hover { background-color: #ffebee; color: #d32f2f; }

    /* Paginación */
    .pagination-container { margin-top: 2rem; display: flex; justify-content: center; }
    .pagination { display: flex; padding-left: 0; list-style: none; gap: 5px; }
    .page-item .page-link { padding: 8px 14px; border: 1px solid #ddd; border-radius: 8px; color: #555; text-decoration: none; transition: all 0.2s; background: white; }
    .page-item .page-link:hover { border-color: #97a992; color: #97a992; }
    .page-item.active .page-link { background-color: #97a992; color: white; border-color: #97a992; }
    .page-item.disabled .page-link { opacity: 0.5; pointer-events: none; }
</style>

<div class="container mt-5 admin-container-stable">
    
    <div class="admin-page-header">
        <div class="admin-page-title-group">
            <a asp-action="Index" class="btn-back" title="Volver al panel principal">
                <span class="material-symbols-outlined">arrow_back</span>
            </a>
            <div>
                <h1 class="admin-page-title">@ViewData["Title"]</h1>
                <p style="color: #777; margin-top: 5px; margin-bottom: 0;">Administrando servicios de esta categoría.</p>
            </div>
        </div>
        <a asp-action="Create" class="btn-add-new">
            <span class="material-symbols-outlined">add_business</span> Nuevo
        </a>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success mb-4" style="border-radius: 12px; background-color: #d1e7dd; color: #0f5132; border: none; padding: 15px 20px;">
            @TempData["SuccessMessage"]
        </div>
    }

    <div class="filters-card">
        <form asp-action="Listado" method="get" class="filter-form">
            <input type="hidden" name="tipo" value="@tipoActual" />
            
            <div class="filter-group">
                <label class="filter-label">Buscar por nombre</label>
                <input type="text" name="searchString" value="@ViewData["CurrentFilter"]" class="filter-input" placeholder="Ej: VetCare..." />
            </div>
            <div style="display: flex; gap: 10px;">
                <button type="submit" class="btn-filter">Filtrar</button>
                <a asp-action="Listado" asp-route-tipo="@tipoActual" class="btn-clear">Limpiar</a>
            </div>
        </form>
    </div>

    <div class="admin-table-card">
        <table class="admin-table">
            <thead>
                <tr>
                    <th class="col-img">Imagen</th>
                    <th class="col-name">Nombre</th>
                    <th class="col-desc">Descripción Corta</th>
                    <th class="col-actions">Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model)
                {
                    <tr>
                        <td>
                            <div class="service-img-container">
                                <img src="@(item.ImagenPrincipalUrl ?? "/images/placeholder.png")" alt="@item.Nombre" class="service-img" onerror="this.src='/images/placeholder.png'" />
                            </div>
                        </td>
                        <td style="font-weight: 600; color: #333;" title="@item.Nombre">
                            @item.Nombre
                        </td>
                        <td style="color: #777;" title="@item.DescripcionCorta">
                            @(item.DescripcionCorta?.Length > 80 ? item.DescripcionCorta.Substring(0, 80) + "..." : item.DescripcionCorta)
                        </td>
                        <td class="col-actions">
                            <a asp-action="Edit" asp-route-id="@item.Id" class="action-btn btn-edit" title="Editar">
                                <span class="material-symbols-outlined" style="font-size: 1.2rem;">edit</span>
                            </a>
                            <form asp-action="Delete" asp-route-id="@item.Id" method="post" style="display: inline-block;" onsubmit="return confirm('¿Eliminar este servicio permanentemente?');">
                                @Html.AntiForgeryToken()
                                <button type="submit" class="action-btn btn-delete" title="Eliminar">
                                    <span class="material-symbols-outlined" style="font-size: 1.2rem;">delete</span>
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <div class="pagination-container">
        @Html.PagedListPager(Model, page => Url.Action("Listado", new { page, tipo = tipoActual, searchString = ViewData["CurrentFilter"] }),
            new PagedListRenderOptions {
                LiElementClasses = new string[] { "page-item" },
                PageClasses = new string[] { "page-link" },
                DisplayLinkToFirstPage = PagedListDisplayMode.Never,
                DisplayLinkToLastPage = PagedListDisplayMode.Never,
                DisplayLinkToPreviousPage = PagedListDisplayMode.Always,
                DisplayLinkToNextPage = PagedListDisplayMode.Always,
                LinkToPreviousPageFormat = "Anterior",
                LinkToNextPageFormat = "Siguiente"
            })
    </div>

</div>