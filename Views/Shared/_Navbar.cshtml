@using Microsoft.AspNetCore.Identity
@using PetConnect.Services

@inject ConfiguracionSitioService configService
@inject SignInManager<IdentityUser> SignInManager

@{
    var logoUrl = await configService.ObtenerValorAsync("UrlLogo", "/images/logoP.png");
    var logoVersion = await configService.ObtenerValorAsync("UrlLogoVersion", "1");
    var logoUrlConVersion = $"{logoUrl}?v={logoVersion}";
    var nombreSitio = await configService.ObtenerValorAsync("NombreSitio", "Purr & Paws");
}

<header class="app-header">
    <div class="logo-container">
        <div class="logo-icon">
            <img src="@logoUrlConVersion" alt="@nombreSitio Logo">
        </div>
        <span class="logo-text">@nombreSitio</span>
    </div>

    <nav class="main-nav">
        <ul>
            <li>
                <a asp-controller="Home" asp-action="Guest">
                    <span class="material-symbols-outlined">home</span>
                    <span class="nav-text">Inicio</span>
                </a>
            </li>
            <li>
                <a asp-controller="Noticias" asp-action="Index">
                    <span class="material-symbols-outlined">newspaper</span>
                    <span class="nav-text">Noticias</span>
                </a>
            </li>
            <li>
                <a asp-controller="Directorio" asp-action="Index">
                    <span class="material-symbols-outlined">volunteer_activism</span>
                    <span class="nav-text">Servicios</span>
                </a>
            </li>

            @if (SignInManager.IsSignedIn(User))
            {
                <li>
                    <a asp-controller="Favorites" asp-action="Index">
                        <span class="material-symbols-outlined">favorite</span>
                        <span class="nav-text">Favoritos</span>
                    </a>
                </li>

                <li class="nav-user-dropdown"> 
                    <button type="button" class="nav-link-button" id="user-menu-button">
                        
                        @{
                            // Leemos el Claim de la foto de perfil
                            var profilePicUrl = User.FindFirst(PetConnectClaimTypes.ProfilePictureUrl)?.Value;
                        }

                        @if (string.IsNullOrEmpty(profilePicUrl))
                        {
                            <span class="material-symbols-outlined">account_circle</span>
                        }
                        else
                        {
                            <img src="@profilePicUrl" alt="Perfil" class="navbar-profile-pic" />
                        }

                        <span class="nav-text">Hola, @User.Identity?.Name!</span>
                        <span class="material-symbols-outlined" style="font-size: 1.2rem;">arrow_drop_down</span>
                    </button>
                    
                    <div class="dropdown-menu-custom" id="user-menu-dropdown">
                        <a asp-area="Identity" asp-page="/Account/Manage/Index">
                            <span class="material-symbols-outlined">person</span>
                            Ver perfil
                        </a>
                        
                        <form asp-area="Identity" asp-page="/Account/Logout" asp-route-returnUrl="@Url.Action("Index", "Home")" method="post">
                            <button type="submit">
                                <span class="material-symbols-outlined">logout</span>
                                Cerrar Sesión
                            </button>
                        </form>
                    </div>
                </li>
            }
            else
            {
                <li>
                    <a asp-area="Identity" asp-page="/Account/Login">
                        <span class="material-symbols-outlined">login</span>
                        <span class="nav-text">Iniciar Sesión</span>
                    </a>
                </li>
            }
        </ul>
    </nav>
</header>